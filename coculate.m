clear all; clc;
format long e;  % 科學記號顯示（15位有效數字）

lamdac = 0.9391
lamdae = 0.7304
a1 = 1.595052025060797
a2 = -0.599019946700523

L1 = 2 + a1 - 4 * lamdae
L2 = 1 + (lamdae^4)/a2
L3 = -(3+lamdae)*(1-lamdae)^3
L4 = -(1-lamdae)^4

a1_a_lamdac = a1-lamdac


%% paper_1

% p1_1 = 0.9898;
% p2_1 = 0.6053;

% a1_1 = p1_1+p2_1;
% a2_1 = p1_1*p2_1;
a1_1 = 1.595052025060797;
a2_1 = 0.599019946700523;

%% paper_2

p1_2 = 0.9733;
p2_2 = 0.9467;
z1_2 = 0.9731;
k_2  = 7.2126e-4;

a1_2 = p1_2+p2_2;
a2_2 = p1_2*p2_2;

%% paper_1 inv_B

fprintf('=== paper_1 invB ===\n');
inv_B_1 = [
    1.254431611705956e+03, 3.659220943459926e+02, 3.627155917884968e+02,5.093482978358023e+02, 5.107001779284304e+02, 4.780582926900250e+02;
    3.546971171665686e+02, 1.162405056456143e+03, 3.879439456363920e+02,6.699392357083276e+02, 6.924786011832921e+02, 4.485820022028297e+02;
    4.275001765633072e+02, 4.539421687049577e+02, 1.258888469891571e+03,4.392720672764521e+02, 4.879780723937001e+02, 5.207798602912907e+02;
    4.425225059058810e+02, 6.546172791671690e+02, 3.537782454546361e+02,1.460679099061605e+03, 8.004859896304748e+02, 4.487782507759195e+02;
    4.141758700238313e+02, 5.725106763685067e+02, 3.374250003002655e+02,6.874793677108798e+02, 1.274435404241492e+03, 3.747160216413520e+02;
    4.122201604485579e+02, 4.009218769846693e+02, 3.684630812134598e+02,4.744034014903570e+02, 4.073700335734076e+02, 1.371560285470157e+03
    ];
disp(inv_B_1);

disp(inv(inv_B_1)/(1-a1_1+a2_1))

%% paper_2 B

fprintf('=== paper_2 B ===\n');
B_2 = [0.2816, -0.0052, -0.0406, -0.0305, -0.0316, -0.0505;
-0.0111,  0.2659, -0.0423, -0.0666, -0.0756, -0.0346;
-0.0470, -0.0332,  0.2795, -0.0064, -0.0237, -0.0530;
-0.0308, -0.0646, -0.0129,  0.2348, -0.0833, -0.0193;
-0.0411, -0.0661, -0.0217, -0.0760,  0.2537, -0.0118;
-0.0477, -0.0208, -0.0402, -0.0250, -0.0056,  0.2302];
disp(B_2);

%% paper2 invB

fprintf('=== paper_2 inv_kB ===\n');
inv(B_2*7.2126e-4)

%% new cali B

fprintf('=== new cali B ===\n');
B = [
0.24658067, -0.00632653, -0.03360383, -0.03693433, -0.04377303,-0.03758178;
-0.00382582, 0.30378633, -0.04427679, -0.07201857, -0.07833279,-0.04142051;
-0.03879909, -0.03543384, 0.21901965, -0.00584744, -0.02633413,-0.03772986;
-0.02718124, -0.0853105, -0.00592537, 0.24953415, -0.07784175,-0.0247489;
-0.04143301, -0.08095197, -0.02381626, -0.07517963, 0.25972779,-0.00510934;
-0.02576626, -0.04007577, -0.02666458, -0.02938011, -0.00287754,0.20256056
];
    
%% test_paper_1
fprintf('=== test_1 ===\n');
test_1 = (1/(1-a1_1+a2_1))*inv(inv_B_1)

%% test_paper_2
fprintf('=== test_2 ===\n');

test_2 = (k_2*(1+z1_2)/((1-p1_2)*(1-p2_2)))*B_2

%% test_new_paper_1_B

fprintf('=== test_new_paper_1_B ===\n');

B_1_new_cali = (k_2*(1+z1_2)/((1-p1_2)*(1-p2_2)))*(1-a1_1+a2_1)*B

B_1 = inv(inv_B_1)

inv_B_1_new_cali = inv(B_1_new_cali)

%% 畫出 (-0.1)/(s*(s-10)) 的波德圖
fprintf('=== Bode Plot of G(s) = (-0.1)/(s*(s-10)) ===\n');

% 定義轉移函數
num = 0.1;  % 分子
den = [1 -10 0];  % 分母: s^2 - 10s + 0 = s*(s-10)

% 建立轉移函數
G = tf(num, den);

% 顯示轉移函數
disp('Transfer Function:');
disp(G);

% 畫波德圖
figure;
bode(G);
grid on;
title('Bode Plot of G(s) = (-0.1)/(s*(s-10))');

% 取得波德圖數據（可選）
[mag, phase, w] = bode(G);

% 找出特定頻率的增益和相位（例如：在 w = 1 rad/s）
w_target = 1;
[mag_at_1, phase_at_1] = bode(G, w_target);
fprintf('At ω = 1 rad/s:\n');
fprintf('  Magnitude = %.4f dB\n', 20*log10(mag_at_1));
fprintf('  Phase = %.2f degrees\n', phase_at_1);

