

#set text(size: 11pt)
#set par(leading: 0.8em)

// == 2. Difference Equation Derivation

#v(1em)

== 1. Low-Pass Filter Difference Equation

#v(0.5em)

#text(size: 14pt)[
$V d_(L P F)[k] = (T) / (2 tau + T) dot (V d[k] + V d[k - 1]) + (2 tau - T) / (2 tau + T) dot V d_(L P F)[k - 1]$
]

#v(0.8em)

Where:
- $T = 1/100000$ (Sampling period = 10 Î¼s)
- $tau = 1/10000$ (Cutoff frequency = 1591.5491 Hz)
// - $alpha = T / (2 tau + T) = 0.0476$ (Filter coefficient 1)
// - $beta = (2 tau - T) / (2 tau + T) = 0.9048$ (Filter coefficient 2)

#v(1.2em)

== 2. PID Control Difference Equation

#v(0.5em)

#text(size: 12pt)[
$e[k] = V d_(L P F)[k] - V m[k]$
]

#v(0.8em)

#text(size: 12pt)[
$u_(P I D)[k] = (K_p + K_i dot T / 2 + K_d / (T / 2)) dot e[k]$
$space space space space space space space space  + (K_i dot T / 2 + K_d / (T / 2) - K_p) dot e[k - 1]$
$space space space space space space space space space + (K_i dot T - 4 dot K_d / T) dot e[k - 2]$
$space space space space space space space space space + u[k - 2]$
]

#v(0.8em)

Where:
- $K_p = 8$
- $K_i = 20000$
- $K_d = 0$





#v(1.2em)

== 3. Total Control Output

#v(0.5em)

#text(size: 12pt)[
$u_(t o t a l)[k] = u_(P I D)[k] + u_(F F)[k]$
]

#v(0.8em)


$u_(F F)[k] = V d_(L P F)[k] "/" F_(g a i n)$ 
#v(0.5em)

Feedforward Gains:
- Channel 0: $F_0 = 0.5716$
- Channel 1: $F_1 = 0.5832$
- Channel 2: $F_2 = 0.5945$
- Channel 3: $F_3 = 0.5389$
- Channel 4: $F_4 = 0.6081$
- Channel 5: $F_5 = 0.5622$

#v(1.2em)

== 4. DAC Output

#v(0.5em)

#text(size: 12pt)[
$bold(V)_(o u t) = bold(M)_(D C) dot bold(u)_(t o t a l)$
]
#pagebreak()

= DC Matrix 

=== Long Fei diagonal norm = 1
```
[0.4820  0.0398  0.0691  0.1061  0.0968  0.0638]
[0.0572  0.3142  0.1288  0.0722  0.0565  0.1342]
[0.0676  0.0916  0.4596  0.0468  0.0830  0.0714]
[0.1267  0.0607  0.0568  0.3803  0.0597  0.1233]
[0.1358  0.0568  0.1200  0.0711  0.3114  0.0559]
[0.0630  0.0955  0.0709  0.1025  0.0378  0.4648]
```

== Commented 

=== Long Fei
```
[0.7143  0.0590  0.1024  0.1572  0.1435  0.0945]
[0.0848  0.4656  0.1908  0.1069  0.0837  0.1989]
[0.1001  0.1357  0.6811  0.0694  0.1230  0.1057]
[0.1877  0.0900  0.0842  0.5635  0.0885  0.1827]
[0.2013  0.0842  0.1778  0.1054  0.4614  0.0828]
[0.0934  0.1416  0.1050  0.1519  0.0561  0.6888]
```

=== Long Fei diagonal norm = $sqrt(6)$
```
[1.1808  0.0975  0.1693  0.2599  0.2372  0.1563]
[0.1401  0.7697  0.3155  0.1768  0.1384  0.3288]
[0.1655  0.2243  1.1259  0.1147  0.2033  0.1748]
[0.3102  0.1488  0.1391  0.9315  0.1462  0.3020]
[0.3327  0.1392  0.2939  0.1743  0.7627  0.1369]
[0.1544  0.2340  0.1736  0.2510  0.0927  1.1386]
```

=== merge V
```
[6.1443  3.1508  2.1931  4.2687  3.9656  2.8689]
[1.6102  4.3544  2.0024  2.7619  3.0089  1.8570]
[1.6713  2.6581  3.9047  2.3873  2.8106  1.9231]
[2.2566  3.2604  1.7581  5.8801  3.9727  2.3370]
[1.6065  2.2319  1.2178  2.5866  4.1330  1.4273]
[1.3310  1.7212  1.2701  1.6959  1.6841  3.8716]
```

=== merge V normalized
```
[0.5219  0.2676  0.1863  0.3626  0.3368  0.2437]
[0.1368  0.3699  0.1701  0.2346  0.2556  0.1577]
[0.1420  0.2258  0.3317  0.2028  0.2387  0.1633]
[0.1917  0.2769  0.1493  0.4995  0.3374  0.1985]
[0.1365  0.1896  0.1034  0.2197  0.3511  0.1212]
[0.1131  0.1462  0.1079  0.1441  0.1430  0.3289]
```

=== merge V normalized sqrt(6)
```
[1.2784  0.6556  0.4563  0.8881  0.8251  0.5969]
[0.3350  0.9060  0.4166  0.5746  0.6260  0.3864]
[0.3477  0.5530  0.8124  0.4967  0.5848  0.4001]
[0.4695  0.6784  0.3658  1.2234  0.8266  0.4862]
[0.3342  0.4644  0.2534  0.5382  0.8599  0.2970]
[0.2769  0.3581  0.2643  0.3529  0.3504  0.8055]
```
#pagebreak()
=== pulse V positive 333 normalized
```
[0.3655  0.1003  0.0868  0.1846  0.1858  0.1562]
[0.0671  0.2665  0.0719  0.1040  0.1321  0.0985]
[0.3534  0.5417  0.5800  0.4935  0.5597  0.4037]
[0.1077  0.1514  0.1094  0.3045  0.1289  0.0963]
[0.1529  0.2152  0.1349  0.2299  0.3910  0.0721]
[0.2462  0.3461  0.2433  0.3566  0.3538  0.4620]
```

=== pulse V positive 333 normalized sqrt(6)
```
[0.8952  0.2456  0.2125  0.4522  0.4551  0.3827]
[0.1644  0.6527  0.1760  0.2547  0.3236  0.2414]
[0.8656  1.3268  1.4206  1.2088  1.3709  0.9888]
[0.2637  0.3708  0.2679  0.7459  0.3158  0.2360]
[0.3745  0.5272  0.3305  0.5631  0.9577  0.1767]
[0.6031  0.8478  0.5959  0.8734  0.8666  1.1317]
```

=== pulse V positive 333 negative 111 normalized
```
[0.3618  -0.015  0.0099  0.0396  0.0542  0.0567]
[0.0315  0.3464  0.0426  0.0998  0.1226  0.0534]
[0.1115  0.1454  0.4318  0.0866  0.1250  0.1290]
[0.1175  0.1872  0.0826  0.4525  0.1882  0.0834]
[0.1147  0.1697  0.0842  0.1859  0.4133  0.0347]
[0.1101  0.1234  0.0960  0.1302  0.1018  0.4326]
```

=== pulse V positive 333 negative 111 normalized sqrt(6)
```
[0.8862  -0.037  0.0243  0.0969  0.1329  0.1388]
[0.0771  0.8485  0.1042  0.2444  0.3002  0.1309]
[0.2732  0.3561  1.0577  0.2120  0.3063  0.3160]
[0.2877  0.4586  0.2024  1.1084  0.4609  0.2044]
[0.2809  0.4156  0.2062  0.4554  1.0124  0.0851]
[0.2698  0.3022  0.2350  0.3188  0.2494  1.0596]
```

=== pulse V positive 111 negative 333 normalized
```
[0.3669  -0.044  -0.025  0.0717  0.0539  0.0662]
[0.0423  0.4385  0.0422  0.1443  0.1714  0.0926]
[0.0006  -0.006  0.3162  -0.125  -0.046  0.0282]
[0.0991  0.1659  0.0501  0.4623  0.1461  0.0854]
[0.0542  0.1006  0.0177  0.1124  0.3488  -0.067]
[0.1161  0.1371  0.1107  0.1450  0.1106  0.4875]
```

=== pulse V positive 111 negative 333 normalized sqrt(6)
```
[0.8987  -0.108  -0.062  0.1756  0.1320  0.1621]
[0.1037  1.0741  0.1033  0.3533  0.4199  0.2268]
[0.0015  -0.015  0.7746  -0.306  -0.113  0.0692]
[0.2428  0.4064  0.1227  1.1324  0.3578  0.2091]
[0.1328  0.2464  0.0433  0.2753  0.8545  -0.163]
[0.2845  0.3359  0.2712  0.3551  0.2709  1.1941]
```